{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = initSingleSource; // Copyright 2019 @polkadot/extension-dapp authors & contributors\n// This software may be modified and distributed under the terms\n// of the Apache-2.0 license. See the LICENSE file for details.\n// RxJs interface, only the bare-bones of what we need here\n// transfor the SingleSource accounts into a simple address/name array\n\nfunction transformAccounts(accounts) {\n  return accounts.map(_ref => {\n    let address = _ref.address,\n        name = _ref.name;\n    return {\n      address,\n      name\n    };\n  });\n} // add a compat interface of SingleSource to window.injectedWeb3\n\n\nfunction injectSingleSource(win) {\n  let accounts = []; // we don't yet have an accounts subscribe on the interface, simply get the\n  // accounts and store them, any get will resolve the last found values\n\n  win.SingleSource.accounts$.subscribe(_accounts => {\n    accounts = transformAccounts(_accounts);\n  }); // decorate the compat interface\n\n  win.injectedWeb3['SingleSource'] = {\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    enable: async origin => ({\n      accounts: {\n        get: async () => accounts,\n        subscribe: cb => {\n          const sub = win.SingleSource.accounts$.subscribe(accounts => {\n            cb(transformAccounts(accounts));\n          });\n          return () => {\n            sub.unsubscribe();\n          };\n        }\n      },\n      signer: win.SingleSource.signer\n    }),\n    version: '0.0.0'\n  };\n} // returns the SingleSource instance, as per\n// https://github.com/cennznet/singlesource-extension/blob/f7cb35b54e820bf46339f6b88ffede1b8e140de0/react-example/src/App.js#L19\n\n\nfunction initSingleSource() {\n  return new Promise(resolve => {\n    window.addEventListener('load', () => {\n      const win = window;\n\n      if (win.SingleSource) {\n        injectSingleSource(win);\n        resolve(true);\n      } else {\n        resolve(false);\n      }\n    });\n  });\n}","map":null,"metadata":{},"sourceType":"script"}